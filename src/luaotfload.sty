%% Copyright (C) 2009-2015
%%
%%      by  Elie Roux      <elie.roux@telecom-bretagne.eu>
%%      and Khaled Hosny   <khaledhosny@eglug.org>
%%      and Philipp Gesang <philipp.gesang@alumni.uni-heidelberg.de>
%%
%% This file is part of Luaotfload.
%%
%%      Home:      https://github.com/lualatex/luaotfload
%%      Support:   <lualatex-dev@tug.org>.
%%
%% Luaotfload is under the GPL v2.0 (exactly) license.
%%
%% ----------------------------------------------------------------------------
%%
%% Luaotfload is free software; you can redistribute it and/or
%% modify it under the terms of the GNU General Public License
%% as published by the Free Software Foundation; version 2
%% of the License.
%%
%% Luaotfload is distributed in the hope that it will be useful,
%% but WITHOUT ANY WARRANTY; without even the implied warranty of
%% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
%% GNU General Public License for more details.
%%
%% You should have received a copy of the GNU General Public License
%% along with Luaotfload; if not, see <http://www.gnu.org/licenses/>.
%%
%% ----------------------------------------------------------------------------
%%
%% Classical Plain+\LATEX package initialization.
%%
\csname ifluaotfloadloaded\endcsname
\let\ifluaotfloadloaded\endinput
\bgroup\expandafter\expandafter\expandafter\egroup
\expandafter\ifx\csname selectfont\endcsname\relax
  \input luatexbase.sty
\else
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{luaotfload}%
    %% FIXME  The date is meaningless, we need to find a way to
    %%        use the git revision instead.
    [2015/03/29 v2.6 OpenType layout system]
  \RequirePackage{luatexbase}
\fi
\RequireLuaModule{luaotfload-main}

% for compatibility with beamer class, which loads pgf package.
\ifcsname selectfont\endcsname
  \AtBeginDocument{\@ifpackageloaded{pgfsys}{
    \csname newtoks\endcsname\pgf@sys@pgf@resource@list@extgs@toks
    \def\pgf@sys@pgf@resource@list@extgs{\the\pgf@sys@pgf@resource@list@extgs@toks}
    \def\pgf@sys@addpdfresource@extgs@plain#1{\global\pgf@sys@pgf@resource@list@extgs@toks
      \expandafter{\the\pgf@sys@pgf@resource@list@extgs@toks #1}}
  }{}}
\endinput\fi
% under plain tex, tikz (pgf) should be loaded before luaotfload.
\ifcsname pgf@sys@pgf@resource@list@extgs\endcsname\else\endinput\fi
\count255=\the\catcode`@\relax
\catcode`@=11\relax
\newtoks\pgf@sys@pgf@resource@list@extgs@toks
\def\pgf@sys@pgf@resource@list@extgs{\the\pgf@sys@pgf@resource@list@extgs@toks}
\def\pgf@sys@addpdfresource@extgs@plain#1{\global\pgf@sys@pgf@resource@list@extgs@toks
  \expandafter{\the\pgf@sys@pgf@resource@list@extgs@toks #1}}
\catcode`@=\the\count255\relax
