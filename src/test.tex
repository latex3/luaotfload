\tracingstats=1
\tracingonline=1

\input luatexbase.sty
\input luaotfload.sty
\directlua{dofile("harf-luaotfload.lua")}
\def\mode{mode=node}
\def\mode{mode=harf}

\font\testr="[lmroman10-regular.otf]:\mode;script=latn;+dlig" at 10pt
\font\testb="[lmroman10-bold.otf]:\mode;script=latn;" at 10pt
\font\testi="[lmromanslant10-regular.otf]:\mode;script=latn;" at 10pt
\font\testR="[lmroman12-regular.otf]:\mode;script=latn;" at 12pt
\font\testA="[amiri-regular.ttf]:\mode;script=arab;" at 10pt
\font\testB="[amiri-bold.ttf]:\mode;script=arab;" at 10pt
\font\testI="[amiri-slanted.ttf]:\mode;script=arab;" at 10pt
\font\testF="[NotoSerifCJK-Regular.ttc]:\mode;script=latn;" at 10pt
\font\testa="[amiri-regular.ttf]:\mode;script=arab;" at 20pt
\font\ruqaa="Aref Ruqaa:\mode;script=arab;" at 18pt
\font\nasta="Noto Nastaliq Urdu:\mode;script=arab;" at 14pt
\font\testc="[amiri-regular.ttf]:\mode;script=arab;color=FF0000" at 20pt

\begingroup\pardir TRT\textdir TRT
\testA
ูุฐุง ูุชุงุจ ุตุบูุฑ ูู ุจุญุซ ุฌุฏูุฏุ ุชูุจูููุง ูู ููุญู ููุดุฑ ุงูุทุจุนุฉ ุงูุซุงููุฉ ูู ูุชุงุจูุง ุงูููุณูุฉ
ุงููุบููุฉ ูุฃูู ููุถูุนู ุชุงุจุน ูููุถูุนูุง. ุฃู ูู ุฎุทูุฉ ุซุงููุฉ ูู ุชุงุฑูุฎ ุงููุบุฉ ุจุงุนุชุจุงุฑ
ููุดุฃูุง ูุชููููุง ูููููุง. ูุงูููุณูุฉ ุงููุบููุฉ ุชุจุญุซ ูู ููู ูุทู ุงูุงูุณุงู ุงูุฃููุ ูููู
ูุดุฃุช ุงููุบุฉ ูุชูููุฏุช ุงูุฃููุงุธ ูู ุญูุงูุฉ ุงูุฃุตูุงุช ุงูุฎุงุฑุฌูุฉุ ู{\testB ูุตู ุงูุฑุนุฏ}ุ ููุจูุจ ุงูุฑูุงุญุ
ูุงููุทุน ูุงููุณุฑุ ูุญูุงูุฉ ุงูุชู ูุงูููุฎ ูุงูุตููุฑ ููุญููุง. ููู ุงูููุงุทุน ุงูุทุจูุนูุฉ ุงูุชู
ููุทู ุจูุง ุงูุงูุณุงู ุบุฑูุฒูุง ูุงูุชุฃููุ ูุงูุฒููุฑ. ูููู ุชูููุนุช ุชูู ุงูุฃุตูุงุช ููุธุง ููุนูู
ุจุงููุญุชุ ูุงูุงุจุฏุงูุ ูุงูููุจุ ุญุชู ุตุงุฑุช ุฃููุงุธุง ูุณุชููุฉ ูุชููููุช ุงูุฃูุนุงูุ ูุงูุฃุณูุงุกุ
ูุงูุญุฑูู ูุตุงุฑุช ุงููุบุฉ ุนูู ูุญู ูุง ูู ุนููู.  ูุฃูุง ุชุงุฑูุฎ ุงููุบุฉ ููุชูุงูู ุงููุธุฑ ูู
ุฃููุงุธูุง ูุชุฑุงููุจูุงุ ุจุนุฏ ุชูุงู ุชููููุงุ ููุจุญุซ ูููุง ุทุฑุฃ ุนููููุง ูู ุงูุชุบููุฑ ูุงูุชุฌุฏุฏ ุฃู
ุงูุฏุซูุฑุ ููุจูู ุงูุฃููุงุธ ูุงูุชุฑุงููุจ ุงูุชู ุฏุซุฑุช ูู ุงููุบุฉ ุจุงูุงุณุชุนูุงูุ ููุง ูุงู ููุงููุง
ูู ุงูุฃููุงุธ ุงูุฌุฏูุฏุฉุ ูุงูุชุฑุงููุจ ุงูุฌุฏูุฏุฉุ ุจูุง ุชูููุฏ ูููุงุ ุฃู ุงูุชุจุณุชู ูู ุณูุงูุงุ ูุน
ุจูุงู ุงูุฃุญูุงู ุงูุชู ูุถุช ุจุฏุซูุฑ ุงููุฏูู ูุชููุฏ ุงูุฌุฏูุฏุ ูุฃูุซูุฉ ููุง ุฏุซุฑุ ุฃู ุฃูููุ ุฃู
ุชูููุฏุ ุฃู ุฏุฎู.

ุงููุญุชูู ุงูุฐู ุชุตู ุฅููู (ูู ุญุงูุฉ ุนุฏู ุงุณุชุฎุฏุงู ููุงูุน ูุคููุฉ ุนู ุทุฑูู ุจุฑูุชูููู ููู
ุงููุต ุงูุชุดุนุจู ุงูุขูู {\textdir TLT HTTPS}).
\par\endgroup\vfill\eject

\def\arabictext{%
ูุฐุง ูุชุงุจ ุตุบูุฑ ูู ุจุญุซ ุฌุฏูุฏุ ุชูุจูููุง ูู ููุญู ููุดุฑ ุงูุทุจุนุฉ ุงูุซุงููุฉ ูู ูุชุงุจูุง ุงูููุณูุฉ
ุงููุบููุฉ ูุฃูู ููุถูุนู ุชุงุจุน ูููุถูุนูุง. ุฃู ูู ุฎุทูุฉ ุซุงููุฉ ูู ุชุงุฑูุฎ ุงููุบุฉ ุจุงุนุชุจุงุฑ
ููุดุฃูุง ูุชููููุง ูููููุง. ูุงูููุณูุฉ ุงููุบููุฉ ุชุจุญุซ ูู ููู ูุทู ุงูุงูุณุงู ุงูุฃููุ ูููู
ูุดุฃุช ุงููุบุฉ ูุชูููุฏุช ุงูุฃููุงุธ ูู ุญูุงูุฉ ุงูุฃุตูุงุช ุงูุฎุงุฑุฌูุฉุ ููุตู ุงูุฑุนุฏุ ููุจูุจ ุงูุฑูุงุญุ
ูุงููุทุน ูุงููุณุฑุ ูุญูุงูุฉ ุงูุชู ูุงูููุฎ ูุงูุตููุฑ ููุญููุง. ููู ุงูููุงุทุน ุงูุทุจูุนูุฉ ุงูุชู
ููุทู ุจูุง ุงูุงูุณุงู ุบุฑูุฒูุง ูุงูุชุฃููุ ูุงูุฒููุฑ. ูููู ุชูููุนุช ุชูู ุงูุฃุตูุงุช ููุธุง ููุนูู
ุจุงููุญุชุ ูุงูุงุจุฏุงูุ ูุงูููุจุ ุญุชู ุตุงุฑุช ุฃููุงุธุง ูุณุชููุฉ ูุชููููุช ุงูุฃูุนุงูุ ูุงูุฃุณูุงุกุ
ูุงูุญุฑูู ูุตุงุฑุช ุงููุบุฉ ุนูู ูุญู ูุง ูู ุนููู.  ูุฃูุง ุชุงุฑูุฎ ุงููุบุฉ ููุชูุงูู ุงููุธุฑ ูู
ุฃููุงุธูุง ูุชุฑุงููุจูุงุ ุจุนุฏ ุชูุงู ุชููููุงุ ููุจุญุซ ูููุง ุทุฑุฃ ุนููููุง ูู ุงูุชุบููุฑ ูุงูุชุฌุฏุฏ ุฃู
ุงูุฏุซูุฑุ ููุจูู ุงูุฃููุงุธ ูุงูุชุฑุงููุจ ุงูุชู ุฏุซุฑุช ูู ุงููุบุฉ ุจุงูุงุณุชุนูุงูุ ููุง ูุงู ููุงููุง
ูู ุงูุฃููุงุธ ุงูุฌุฏูุฏุฉุ ูุงูุชุฑุงููุจ ุงูุฌุฏูุฏุฉุ ุจูุง ุชูููุฏ ูููุงุ ุฃู ุงูุชุจุณุชู ูู ุณูุงูุงุ ูุน
ุจูุงู ุงูุฃุญูุงู ุงูุชู ูุถุช ุจุฏุซูุฑ ุงููุฏูู ูุชููุฏ ุงูุฌุฏูุฏุ ูุฃูุซูุฉ ููุง ุฏุซุฑุ ุฃู ุฃูููุ ุฃู
ุชูููุฏุ ุฃู ุฏุฎู.%
}

\begingroup\pardir TRT\textdir TRT
\testa
\baselineskip=2em
\arabictext
\par\endgroup\vfill\eject

\begingroup\pardir TRT\textdir TRT
\ruqaa
\baselineskip=2.2em
\arabictext
\par\endgroup\vfill\eject

\begingroup\pardir TRT\textdir TRT
\nasta
\baselineskip=3em
\arabictext
\par\endgroup\vfill\eject

\begingroup\pardir TRT\textdir TRT
\testa ููุจู {\testc ุชููู ููู} ุจููู ุงูุญุจ.
\par\endgroup\vfill\eject

\begingroup\pardir TRT\textdir TRT
\font\quran="Amiri Quran Colored:\mode;script=arab;" at 20pt
\quran
\baselineskip=2.6em
\parindent=0pt
\leftskip=0pt plus 1fil
\rightskip=0pt plus -1fil
\parfillskip=0pt plus 2fil
\def\aya#1{{\textdir TLT ^^^^06dd#1}}
^^^^fdfd~\aya{ูก}\par
ูฑูกุญููกุฏู ููููููู ุฑูุจูู ูฑูกุนููฐูููููู~\aya{ูข} ูฑูุฑููุญกูููฐูู ูฑูุฑููุญููู~\aya{ูฃ} ูููฐูููู ููกูู ูฑูุฏูููู~\aya{ูค} ุฅูููุงูู ููุนกุจูุฏู ููุฅูููุงูู ููุณกุชูุนููู~\aya{ูฅ} ูฑูกุฏูููุง ูฑูุตููุฑููฐุทู ูฑูกููุณกุชููููู~\aya{ูฆ} ุตูุฑููฐุทู ูฑูููุฐููู ุฃููกุนููกุชู ุนูููกูููก ุบูกุฑู ูฑูกููุบกุถููุจู ุนูููกูููก ููููุง ูฑูุถููุงคููููู~\aya{ูง}\par
\endgroup\vfill\eject

\begingroup
\font\bungeea="[BungeeColor1.ttf]:\mode;script=latn;colr=true" at 50pt
\font\bungeeb="[BungeeColor1.ttf]:\mode;script=latn;colr=2" at 50pt
\bungeea ABCDEFG\par
\bungeeb ABCDEFG\par

\font\emoji="Noto Color Emoji:\mode;script=latn" at 24pt
\emoji
๐๐๐๐๐๐ค๐งก๐๐๐ง๐ฝ๐ฆ

\endgroup\vfill\eject

\begingroup
\testA
\TeX\ = ฯฮตฯ in Greek

({\testI f\/})

\def\l#1#2{%
  \begingroup%
  \font\testl="[amiri-regular.ttf]:\mode;script=arab;language=#1" at 10pt
  \testl #2%
  \endgroup%
}
\l{ARA}{ููกูขูฃูคูฅูฆูงูจูฉ}\par
\l{FAR}{ฐฑฒณดตถทธน}\par
\l{URD}{ฐฑฒณดตถทธน}\par
\l{SND}{ฐฑฒณดตถทธน}\par
\l{KSH}{ฐฑฒณดตถทธน}\par

Some text then inline math $E=mc^2$ then $\hbox{text inside inline math}$, then
display math $$E=mc^2\hbox{ with text inside}$$

\endgroup\vfill\eject

\begingroup
\parindent=0pt
\testF
\noindent
\smallskip
offbeat office baffle coffee HAVANA\par
\smallskip
\begingroup
\rightskip=0pt plus1fil \pretolerance=-1 \hyphenpenalty=-10000
offbeat office baffle coffee HAVANA\par
\endgroup
\endgroup
\vfill\eject

\begingroup
\parindent=0pt
\testr
\noindent
\smallskip
offbeat office baffle {\rm baffle} coffee HAVANA\par
\smallskip
\begingroup
\rightskip=0pt plus1fil \pretolerance=-1 \hyphenpenalty=-10000
offbeat office baffle {\rm baffle} coffee HAVANA\par
\endgroup
\endgroup
\vfill\eject

\testr
\hrule
\vskip 1in
\centerline{\testb A SHORT STORY}
\vskip 6pt
\centerline{\testi by A. U. Thor}
\vskip .5cm
Once upon a time, in a distant {\testR galaxy called} รรถรง, there lived a computer named
R.~J. Drofnats.

Mr.~Drofnats-----or โโR. J.,โโ as he {\textdir TRT preferred} to be called-----was happiest when he
was at work typesetting beautiful documents.
\vskip 1in
\hrule
\vfill\eject

\font\test=cmr10 at 12pt
\test
\input story
\bye
